import telebot
import openai
import threading
import random
from dotenv import load_dotenv
import os

load_dotenv()

from flask import Flask

# ุฅูุดุงุก ุชุทุจูู ููุจ ุตุบูุฑ ูุฅุจูุงุก Replit ูุดุทูุง
app = Flask(__name__)

@app.route('/')
def home():
    return "ุจูุช ุงูุชูุญุฏ ูุนูู ุจูุฌุงุญ ๐"

# ๐น ุฃุฏุฎู ููุงุชูุญู ููุง
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")



# ุฅุนุฏุงุฏ ุงูุจูุช
bot = telebot.TeleBot(TOKEN)

# ุชููุฆุฉ OpenAI API
openai.api_key = OPENAI_API_KEY

# ูุงุฆูุฉ ูุตุงุฆุญ ุนู ุงูุชูุญุฏ
tips = [
    "๐ก ุงูุชูุญุฏ ููุณ ูุฑุถูุงุ ุจู ุงุฎุชูุงู ูู ุทุฑููุฉ ุนูู ุงูุฏูุงุบ. ูู ุฏุงุนููุง ููุชููููุง. ๐ค",
    "๐ฏ ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุชูุญุฏ ูุฏ ูุนุงููู ูู ุญุณุงุณูุฉ ุฒุงุฆุฏุฉ ููุฃุตูุงุช ุฃู ุงูุฃุถูุงุก. ุญุงูู ุชูููุฑ ุจูุฆุฉ ูุงุฏุฆุฉ ููู. ๐ฟ",
    "๐ ูู ุงููููุฏ ุงุณุชุฎุฏุงู ุงูุตูุฑ ูุงููุตุต ุงููุตูุฑุฉ ููุณุงุนุฏุฉ ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุชูุญุฏ ุนูู ููู ุงูููุงูู ุงูุงุฌุชูุงุนูุฉ. ๐ผ๏ธ",
    "๐ฃ๏ธ ุจุนุถ ุงูุฃุทูุงู ุงููุตุงุจูู ุจุงูุชูุญุฏ ูุง ูุชุญุฏุซููุ ููู ูููููู ุงูุชูุงุตู ุจุทุฑู ุฃุฎุฑู ูุซู ุงูุฅุดุงุฑุงุช ุฃู ุงูุชุทุจููุงุช ุงููุฎุตุตุฉ. ๐ฑ",
    "โค๏ธ ุงูุฏุนู ูุงูุชููู ูู ุงูุฃุณุฑุฉ ูุงููุฌุชูุน ูุณุงุนุฏ ุงูุฃุดุฎุงุต ุงููุตุงุจูู ุจุงูุชูุญุฏ ุนูู ุชุญููู ุฅููุงููุงุชูู ุงููุงููุฉ. ๐"
]

# ูุงุฆูุฉ ูุตุต ูุฌุงุญ ููููุฉ
stories = [
    "๐ **ุชูุจู ุฌุฑุงูุฏูู** - ูุงูุช ุทููุฉ ูุตุงุจุฉ ุจุงูุชูุญุฏ ููู ุชูู ุชุชุญุฏุซ ุญุชู ุนูุฑ 4 ุณููุงุชุ ููููุง ุฃุตุจุญุช ุนุงููุฉ ูุดููุฑุฉ ูู ุณููู ุงูุญููุงูุงุช ููุชุญุฏุซุฉ ุนุงูููุฉ ุนู ุงูุชูุญุฏ! ๐ง",
    "๐ **ุฌุงูู ุจุงุฑููุช** - ุชู ุชุดุฎูุตู ุจุงูุชูุญุฏ ูู ุนูุฑ ุณูุชููุ ูููู ุฃุตุจุญ ููุฒูุงุฆููุง ุนุจูุฑููุง ูุงูุชุญู ุจุงูุฌุงูุนุฉ ูู ุณู 10 ุณููุงุช! ๐",
    "๐ **ุฅููุฌุงู ูุงููุงู** - ุทูู ูุชูุญุฏ ุฃุตุจุญ ูููุฏุณูุง ููุฎุชุฑุนูุง ูุณุงูู ูู ุชุทููุฑ ุฃูุธูุฉ ุงูุชุดุญูู ูููุทุงุฑุงุช! ๐๏ธ",
    "๐จ **ุณุชููู ูููุชุดูุฑ** - ููุงู ููููุจ ูุตุงุจ ุจุงูุชูุญุฏ ููููู ุฑุณู ูุฏู ูุงููุฉ ุจุชูุงุตูู ุฏูููุฉ ูู ุงูุฐุงูุฑุฉ ููุท! ๐๏ธ",
    "๐ต **ุฏูุฑูู ุจุงุฑุงููุชุดููู** - ููุณููู ูููู ูุตุงุจ ุจุงูุชูุญุฏุ ูููู ูุณุชุทูุน ุนุฒู ุฃู ุฃุบููุฉ ูู ูุฑุฉ ูุงุญุฏุฉ ููุท ุจุณูุงุนู ููุง! ๐น"
]

# ุฃูุฑ /start
@bot.message_handler(commands=['start'])
def start(message):
    welcome_text = """
๐ค *ูุฑุญุจูุง! ุฃูุง AutismSupportBot*  
ุฃูุง ููุง ููุณุงุนุฏุชู ูู ุงูุฅุฌุงุจุฉ ุนูู ุฃู ุฃุณุฆูุฉ ุญูู ุงูุชูุญุฏ. ๐  
๐ก ููููู ุณุคุงูู ุนู ุงูุฃุนุฑุงุถุ ุทุฑู ุงูุนูุงุฌุ ุฃู ุฃู ุงุณุชูุณุงุฑ ุขุฎุฑ.  
๐น *ูุซุงู ููุฃุณุฆูุฉ:*  
- ูุง ูู ุงูุชูุญุฏุ  
- ููู ุฃุชุนุงูู ูุน ุทูู ูุตุงุจ ุจุงูุชูุญุฏุ  
- ูู ููุงู ุนูุงุฌ ููุชูุญุฏุ  

๐ ุงุณุชุฎุฏู ุงูุฃูุงูุฑ ุงูุชุงููุฉ:  
๐น `/tip` โ ุงุญุตู ุนูู ูุตูุญุฉ ุนู ุงูุชูุญุฏ  
๐ `/story` โ ุงุณุชูุน ุฅูู ูุตุฉ ูุฌุงุญ ููููุฉ  
๐ฉ *ุงุฑุณู ุณุคุงูู ุงูุขู!*  
    """
    bot.send_message(message.chat.id, welcome_text, parse_mode="Markdown")

# ุฃูุฑ /tip ูุฅุฑุณุงู ูุตูุญุฉ ุนุดูุงุฆูุฉ
@bot.message_handler(commands=['tip'])
def send_tip(message):
    bot.send_message(message.chat.id, random.choice(tips))

# ุฃูุฑ /story ูุฅุฑุณุงู ูุตุฉ ูุฌุงุญ ููููุฉ
@bot.message_handler(commands=['story'])
def send_story(message):
    bot.send_message(message.chat.id, random.choice(stories))

# ุงูุฑุฏ ุนูู ุฃู ุฑุณุงูุฉ ูุตูุฉ ุจุงุณุชุฎุฏุงู ChatGPT
@bot.message_handler(content_types=['text'])
def gptMessage(message):
    user_message = message.text  

    try:
        # ุฅุฑุณุงู ุงูุทูุจ ุฅูู OpenAI API
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": "ุฃุฌุจ ุจููุณ ูุบุฉ ุงููุณุชุฎุฏู ูุจุฃุณููุจ ูุงุถุญ ูุณูู."},
                {"role": "user", "content": user_message}
            ]
        )

        bot_response = response["choices"][0]["message"]["content"]

        # ุฅุฑุณุงู ุงูุฅุฌุงุจุฉ ูุน ุชูุณูู ุฌููู ูุฒุฑ "ูุนูููุงุช ุฅุถุงููุฉ"
        markup = telebot.types.InlineKeyboardMarkup()
        more_info_button = telebot.types.InlineKeyboardButton("๐ ูุนูููุงุช ุฅุถุงููุฉ", url="https://www.autismspeaks.org/")
        markup.add(more_info_button)

        bot.send_message(message.chat.id, f"๐น *ุฅุฌุงุจุฉ:* {bot_response}", parse_mode="Markdown", reply_markup=markup)

    except Exception as e:
        error_message = f"โ ุญุฏุซ ุฎุทุฃ: {e}"
        bot.send_message(message.chat.id, error_message)
        print(f"ุฎุทุฃ ูู ุงูุงุชุตุงู ุจู OpenAI: {e}")

# ุชุดุบูู ุงูุจูุช ุจุดูู ูุณุชูุฑ ูู Thread ูููุตู
def run_bot():
    bot.infinity_polling()

threading.Thread(target=run_bot).start()

# ุชุดุบูู ุชุทุจูู ุงูููุจ ููุญูุงุธ ุนูู Replit ูุดุทูุง
app.run(host="0.0.0.0", port=8080)











  